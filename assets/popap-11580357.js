import{c as b,a as w,b as x}from"./scroll-ca610e3c.js";import{P as A,a as S,S as v,b as B}from"./vendor-8057a9e6.js";const E=document.getElementById("pagination");let p=0;const C=window.innerWidth;C<768?p=2:p=4;function _(e,t,o){const s={totalItems:e.totalPages*t,itemsPerPage:t,visiblePages:p,page:o,centerAlign:!1,template:{page:'<a href="#" class="tui-page-btn">{{page}}</a>',currentPage:'<strong class="tui-page-btn tui-is-selected">{{page}}</strong>',moveButton:'<a href="#" class="tui-page-btn tui-{{type}}"><span class="tui-ico-{{type}}">{{type}}</span></a>',disabledMoveButton:'<span class="tui-page-btn tui-is-disabled tui-{{type}}"><span class="tui-ico-{{type}}">{{type}}</span></span>',moreButton:'<a href="#" class="tui-page-btn tui-is-disabled tui-{{type}}-is-ellip"><span class="tui-ico-ellip">...</span></a>'}};new A(E,s).on("afterMove",n=>{const r=n.page;var a=JSON.parse(localStorage.getItem("filters"))||{};a.page=r,localStorage.setItem("filters",JSON.stringify(a)),l()})}function T(){E.innerHTML=""}async function P(e,t,o,s,c){try{const n={keyword:t||"",category:e||"",page:o||1,limit:s||4};c&&(n.sort=c);const r=await S({method:"get",url:"https://food-boutique.b.goit.study/api/products",params:n});return r.data.totalPages>1?_(r.data,s,o):T(),r.data.results}catch(n){return console.error("Error fetching products:",n),[]}}async function k(e){return(await S(`https://food-boutique.b.goit.study/api/products/${e}`)).data}const M="/Test-task/assets/check-267a6277.svg",I=document.querySelector(".products-container"),m="products in cart";function y(e){const t=document.querySelector(".products-container");!e||e.length===0?t.innerHTML=`<div class="cart-empty empty-filter">
           <h3 class="products-titel">Nothing was found for the selected <span>filters...</span></h3>
           <p class="filters-text-not-found">Try adjusting your search parameters or browse our range by other criteria to find the perfect campers for you.</p>
       </div>`:t.innerHTML=b(e)}O();async function O(){try{const e=await P("Fresh_Produce");I.insertAdjacentHTML("beforeend",b(q(e))),w()}catch(e){console.log(e.message)}}I.addEventListener("click",f);async function f(e){if(e.target.nodeName==="BUTTON"||e.target.className==="add-btn"||e.target.nodeName==="IMG"){const t=e.target.closest(".list-item-body-price");if(t&&t.parentElement){const o=t.parentElement.id;try{const s=await k(o),c=JSON.parse(localStorage.getItem(m))??[],n=c.findIndex(r=>r._id===o);if(n!==-1)c[n].quantity+=0;else{s.quantity=1,c.push(s);const r=t.querySelector("button");r.disabled=!0,r.innerHTML=`<img src="${M}" alt="icon check" width="18" height="18">`,r.classList.add("disabled")}localStorage.setItem(m,JSON.stringify(c)),w()}catch(s){console.error(s.message)}}}}function q(e){return e.map(t=>{let o=t.category;return typeof o=="string"&&(o=o.split("_").join(" ")),{...t,category:o}})}let g=!1;function F(e,t,o){let s;return function(){const c=this,n=arguments,r=function(){s=null,o||e.apply(c,n)},a=o&&!s;clearTimeout(s),s=setTimeout(r,t),a&&e.apply(c,n)}}document.addEventListener("DOMContentLoaded",function(){U(),j(),$(),W(),H();const e=document.getElementById("search-box"),t=document.getElementById("categories"),o=document.getElementById("sort-options"),s=d();e.value=s.keyword||"",t.value=s.category||"",o.value=s.sort||"",l()});const D=document.querySelector(".search-form");D.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("search-box").value.trim();u("keyword",t),l(),L()});function J(){const e=window.innerWidth,t=e>=768&&e<1150;let o=6;t?o=8:e>=1150&&(o=9);const s=d();s.limit=o,localStorage.setItem("filters",JSON.stringify(s)),l()}window.addEventListener("resize",F(J,300));async function H(){try{const e=await fetch("https://food-boutique.b.goit.study/api/products/categories");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();t&&t.length>0?z(t):console.error("No categories found")}catch(e){console.error("Error fetching categories:",e)}}function z(e){const t=document.getElementById("categories");t.innerHTML="";const o=[{text:"Show all",value:""},...e.map(s=>({text:s.replace(/_/g," "),value:s}))];new v({select:"#categories",placeholder:"Categories",showSearch:!1,data:o})}function W(){new v({select:"#sort-options",data:[{text:"A to Z",value:"byABC_Asc"},{text:"Z to A",value:"byABC_Desc"},{text:"Cheap",value:"byPrice_Asc"},{text:"Expensive",value:"byPrice_Desc"},{text:"Popular",value:"byPopularity_Asc"},{text:"Not popular",value:"byPopularity_Desc"},{text:"Show all",value:"showAll"}]})}function j(){const e=document.getElementById("categories"),t=document.getElementById("sort-options");e.addEventListener("change",h),t.addEventListener("change",h)}function h(){const e=document.getElementById("categories").value,t=document.getElementById("sort-options").value;u("category",e),u("sort",t),l(),L()}function L(){u("page",1)}async function l(){if(g)return;g=!0;const e=d(),{category:t,keyword:o,page:s,limit:c,sort:n}=e;try{const r=await P(t,o,s,c,n);if(!Array.isArray(r))throw new Error("Response is not an array of products");switch(n){case"byABC_Asc":r.sort((a,i)=>a.name.localeCompare(i.name));break;case"byABC_Desc":r.sort((a,i)=>i.name.localeCompare(a.name));break;case"byPrice_Asc":r.sort((a,i)=>a.price-i.price);break;case"byPrice_Desc":r.sort((a,i)=>i.price-a.price);break;case"byPopularity_Asc":r.sort((a,i)=>a.popularity-i.popularity);break;case"byPopularity_Desc":r.sort((a,i)=>i.popularity-a.popularity);break}y(r)}catch(r){console.error("Error fetching products:",r),y([])}finally{g=!1}}function U(){localStorage.getItem("filters")||N()}function u(e,t){const o=d();o[e]=t,localStorage.setItem("filters",JSON.stringify(o))}function N(){localStorage.setItem("filters",JSON.stringify({keyword:null,category:null,page:1,limit:6}))}function d(){return JSON.parse(localStorage.getItem("filters"))||N()}function $(){l()}const R=document.querySelector(".products-container");R.addEventListener("click",Z);function Z(e){if(!(e.target===e.currentTarget||e.target.nodeName==="BUTTON"||e.target.className==="add-btn"||e.target.className==="popular-basket-img"||e.target.className==="icon-styles"||e.target.className==="discount-basket-icon"||e.target.alt==="icon-icon-favorite")&&e.target.closest(".list-item")!==null){const o=e.target.closest(".list-item").id;G(o)}}async function G(e,t){try{let r=function(a){(a.target.className==="remove-btn"||a.target.className==="remove-btn-img")&&c.close()};const o=[await k(e)],s=a=>{c.visible()&&a.key==="Escape"&&c.close()},c=B.create(x(o),{onClose:a=>document.removeEventListener("keydown",s),onClose:a=>n.querySelector(".add-btn").removeEventListener("click",f),onClose:a=>n.removeEventListener("click",r)});c.show(),document.addEventListener("keydown",s);const n=document.querySelector(".basicLightbox__placeholder");n.querySelector(".add-btn").addEventListener("click",f),n.addEventListener("click",r)}catch(o){console.log(o.message)}}
//# sourceMappingURL=popap-11580357.js.map
